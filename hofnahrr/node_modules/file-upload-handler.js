/*global __dirname, require, exports */
var fileSystem = require("fs"),
    path = require('path'),
    FileUploadHandler = null;


FileUploadHandler = function (options) {
    this.imageDir = options.imageDir;
};

FileUploadHandler.create = function (options) {
    return new FileUploadHandler(options);
};

/*
 * Handle file upload
 */
FileUploadHandler.prototype = {
    writeFile : function (file, error, success) {
        var filePath = path.join(__dirname, this.imageDir, file.name),
            readStream = fileSystem.createReadStream(file._writeStream.path),
            writeStream = fileSystem.createWriteStream(filePath);

        writeStream.on('error', function (e) {
            console.log("Error writing file");
            if (error) {
                error(e);
            }
        });

        readStream.on('data', function (data) {
            writeStream.write(data);
            console.log("writing data");
        });

        readStream.on('close', function () {
            writeStream.end();
            console.log("Finished reading");
            if (success) {
                success({
                    name : file.name
                });
            }
        });

    }
};

exports.FileUploadHandler = FileUploadHandler;
